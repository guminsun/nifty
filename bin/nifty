#! /usr/bin/env python

import os, sys
from pprint import pprint

nifty_exe_dir = os.path.dirname(__file__)    # bin/nifty
nifty_top = os.path.split(nifty_exe_dir)[0]  # ../
nifty_dir = os.path.join(nifty_top, 'nifty') # ../nifty/

if os.path.isdir(nifty_dir):
    sys.path.insert(0, nifty_top)

from nifty.analyzer.nifty_analyzer import analyze
from nifty.emitter.nifty_emitter import emit
from nifty.organizer.nifty_organizer import organize
from nifty.parser.nifty_parser import parse
from nifty.translator.nifty_translator import translate

def main():
    if len(sys.argv) > 1:
        filename = sys.argv[1]
        ast = parse(open(filename).read())
    else:
        ast = parse(sys.stdin.read())
    ast = organize(ast)
    ast = analyze(ast)
    instructions = translate(ast)
    instructions = emit(instructions)
    pprint(instructions)

if __name__ == '__main__':
    main()
